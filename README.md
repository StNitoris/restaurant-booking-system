# 餐厅预订系统

本项目是一个使用 C++17 面向对象方法实现的简易餐厅预订与点餐管理系统。系统根据给定的用例图和分析类图构建，涵盖桌位管理、预订流程、散客处理、订单记录以及经营报表等核心功能。

## 功能概览

- **桌位管理**：维护桌位容量与状态，支持自动分配合适的桌位。
- **预订管理**：记录顾客信息、到店时间、预订备注，并支持状态变更（待到店、已入座、已完成、已取消）。
- **预订维护**：支持通过 HTTP API 查询单条预订详情、修改顾客信息/就餐时间/桌位安排，或直接删除（标记取消）。
- **散客处理**：快速为散客创建即时预订并尝试安排桌位。
- **点餐管理**：按预订记录订单及菜品，自动计算订单金额，并在前端实时展示。
- **经营报表**：生成当日预订数量、入座人数和营业收入的概览。
- **员工与权限**：区分前台与经理角色，体现权限控制模型。
- **数据持久化**：所有桌位、预订与订单会自动持久化到本地数据文件，再次启动时会自动恢复。支持自定义存储路径。

## 代码结构

```
├── CMakeLists.txt
├── README.md
├── src
│   ├── ReservationSystem.hpp   // 系统核心类与数据结构声明
│   ├── ReservationSystem.cpp   // 核心逻辑实现
│   ├── SeedData.cpp/.hpp       // 示例基础数据装载
│   ├── WebServer.cpp/.hpp      // 极简 HTTP 服务端实现
│   ├── main.cpp                // 命令行界面入口
│   └── web_main.cpp            // Web 前端入口
└── web
    ├── index.html              // 单页前端界面
    ├── styles.css              // 界面样式
    └── app.js                  // 与后端交互的脚本
```

## 构建与运行

```bash
cmake -S . -B build
cmake --build build

# 命令行模式
./build/restaurant_booking [数据文件路径]

# Web 前端模式（默认端口 8080，可通过参数指定其他端口与静态目录）
./build/restaurant_booking_server [端口号] [静态文件目录] [数据文件路径]
```

> **Windows / Visual Studio 用户**
>
> 1. 在 Visual Studio 中选择“打开本地文件夹”，指向本仓库根目录。
> 2. 首次打开时 VS 会自动侦测到 `CMakeLists.txt` 并生成 `build` 目录，如未自动生成，可在“生成”菜单里选择“全部生成”。
> 3. 生成成功后，在“CMake Targets”视图中找到 `restaurant_booking`（命令行版）或 `restaurant_booking_server`（Web 版），右键选择“调试/启动”。
> 4. 根据需要在“调试参数”中追加数据文件路径，例如 `data/booking_data.txt`。Web 与 CLI 版本都会在启动时优先尝试读取该文件的历史记录；如果文件不存在，会使用示例数据并立即创建。
> 5. Web 版本启动后，用浏览器访问 `http://localhost:8080`（若修改了端口，则访问对应端口）。该可执行文件会同时托管前端静态资源与 REST API，只需运行这一进程即可避免浏览器中出现“无法连接到后端”的提示。

命令行程序启动后将显示交互式菜单，可根据提示进行桌位查询、创建预订、处理散客、录入点餐以及生成报表等操作。

Web 版本会在本地启动一个极简的 HTTP 服务，默认挂载 `web/` 目录下的静态前端页面。启动后在浏览器访问 `http://localhost:8080` 即可看到可视化界面：

- **桌位概览**：以卡片形式展示当前桌位状态。
- **预订列表**：展示所有预订并支持一键切换状态（入座/完成/取消）。
- **预订维护操作**：在列表中直接删除预订，或通过 API 更新客人信息、就餐时间与桌位；悬停可查看预计结束时间与最近更新时间。
- **创建预订/散客登记**：通过表单向后台提交数据，成功后即时刷新视图。
- **点餐与订单列表**：支持为指定预订录入菜品数量，服务端计算订单金额并展示订单明细。
- **菜单与经营数据**：实时拉取示例菜单与当日报表，方便课堂演示。
- **员工信息**：展示种子数据中配置的前台与经理账号，呼应权限模型。

> 小贴士：如果你直接从文件系统打开 `web/index.html`，前端会自动将所有 API 请求指向 `http://localhost:8080`。如需改用其他后端地址，可在浏览器控制台设置 `window.__BOOKING_API_BASE__ = "http://你的地址"` 后再刷新页面。内置 HTTP 服务已默认开启跨域访问控制，因此在本地启动服务端后，即使从 `file://` 协议打开页面也能成功请求 API。

前端仅作为课程作业的演示界面，如需重置示例数据可删除（或备份）对应的数据文件后重新启动程序。

## 数据持久化

- 默认情况下，CLI 与 Web 服务都会将数据写入仓库根目录下的 `data/booking_data.txt`（若路径不存在会自动创建所需目录）。
- 在命令行传入额外参数即可切换到其它文件路径，适合在不同环境或多套示例之间切换：
  - `./build/restaurant_booking custom/path.txt`
  - `./build/restaurant_booking_server 8080 web custom/path.txt`
- 数据文件保存桌位、预订、订单及其时间戳等全部信息，重新启动后会自动恢复，无需重新录入示例数据。
- 若无法写入指定路径，程序会在控制台输出错误提示，请确认拥有相应的文件系统权限。

- **HTTP API 拓展**：
  - `GET /api/reservations/{id}`：返回单条预订的完整详情（顾客信息、时间、桌位、状态、最后更新时间等）。
  - `PUT /api/reservations/{id}`：使用 `application/x-www-form-urlencoded` 提交字段以更新顾客信息、就餐时间、时长、备注与（可选）桌位。
  - `DELETE /api/reservations/{id}`：将预订标记为取消并释放桌位。
