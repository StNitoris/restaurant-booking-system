# 餐厅预订系统

本项目是一个使用 C++17 面向对象方法实现的简易餐厅预订与点餐管理系统。系统根据给定的用例图和分析类图构建，涵盖桌位管理、预订流程、散客处理、订单记录以及经营报表等核心功能。

## 功能概览

- **桌位管理**：维护桌位容量与状态，自动挑选最合适的桌位，并可查看每张桌当前关联的预订与订单。
- **预订管理**：记录顾客信息、到店时间、预订备注，并支持状态变更（待到店、已入座、已完成、已取消）。
- **预订维护**：支持通过 HTTP API 查询单条预订详情、修改顾客信息/就餐时间、手动或自动重新分配桌位，以及直接删除预订并清理关联订单。
- **散客处理**：快速为散客创建即时预订并尝试安排桌位。
- **点餐管理**：按预订记录订单及菜品，自动计算订单金额，并在前端实时展示。
- **经营报表**：生成当日预订数量、入座人数和营业收入的概览。
- **员工与权限**：区分前台与经理角色，体现权限控制模型。
- **编号体系**：常规预订使用 `R` 前缀编号，散客即时单使用 `W` 前缀，便于在列表中快速识别来源。

## 代码结构

```
├── CMakeLists.txt
├── README.md
├── src
│   ├── ReservationSystem.hpp   // 系统核心类与数据结构声明
│   ├── ReservationSystem.cpp   // 核心逻辑实现
│   ├── SeedData.cpp/.hpp       // 示例基础数据装载
│   ├── WebServer.cpp/.hpp      // 极简 HTTP 服务端实现
│   ├── main.cpp                // 命令行界面入口
│   └── web_main.cpp            // Web 前端入口
└── web
    ├── index.html              // 单页前端界面
    ├── styles.css              // 界面样式
    └── app.js                  // 与后端交互的脚本
```

## 构建与运行

```bash
cmake -S . -B build
cmake --build build

# 命令行模式
./build/restaurant_booking

# Web 前端模式（默认端口 8080，可通过参数指定其他端口与静态目录）
./build/restaurant_booking_server [端口号] [静态文件目录]
```

> **Windows / Visual Studio 用户**
>
> 1. 在 Visual Studio 中选择“打开本地文件夹”，指向本仓库根目录。
> 2. 首次打开时 VS 会自动侦测到 `CMakeLists.txt` 并生成 `build` 目录，如未自动生成，可在“生成”菜单里选择“全部生成”。
> 3. 生成成功后，在“CMake Targets”视图中找到 `restaurant_booking`（命令行版）或 `restaurant_booking_server`（Web 版），右键选择“调试/启动”。
> 4. Web 版本启动后，用浏览器访问 `http://localhost:8080`（若修改了端口，则访问对应端口）。
>    如果操作系统优先解析 IPv6，也可以直接访问 `http://[::1]:8080`，或明确指定 IPv4 地址 `http://127.0.0.1:8080`。
>    该可执行文件会同时托管前端静态资源与 REST API，只需运行这一进程即可避免浏览器中出现“无法连接到后端”的提示。

命令行程序启动后将显示交互式菜单，可根据提示进行桌位查询、创建预订、处理散客、录入点餐以及生成报表等操作。

Web 版本会在本地启动一个极简的 HTTP 服务，默认挂载 `web/` 目录下的静态前端页面。启动后在浏览器访问 `http://localhost:8080` 即可看到可视化界面：

- **桌位概览**：以卡片形式展示当前桌位状态，并列出各桌关联的预订与订单号。
- **预订列表**：展示所有预订，可一键切换状态（入座/完成/取消）、直接删除预订，以及就地手动/自动分配或释放桌位。
- **创建预订/散客登记**：通过表单向后台提交数据，成功后即时刷新视图。
- **点餐与订单列表**：支持为指定预订录入菜品数量，服务端计算订单金额并展示订单明细。
- **菜单与经营数据**：实时拉取示例菜单与当日报表，方便课堂演示。
- **员工信息**：展示种子数据中配置的前台与经理账号，呼应权限模型。

### 浏览器使用说明（需连接后端）

- 推荐通过 `./build/restaurant_booking_server` 直接托管前端与 API：运行后访问 `http://localhost:8080`（或指定端口）即可完成预订、点餐等操作，所有数据都由后台进程维护。
- 如需从其他来源访问（例如前端部署在不同主机或通过 `file://` 打开），可：
  - 在地址栏追加查询参数 `?api=http://你的地址:端口`（如 `?api=http://localhost:8880`），页面会自动记住并复用该地址；或
  - 在浏览器控制台设置 `window.__BOOKING_API_BASE__ = "http://你的地址"` 后刷新；或
  - 写入 `localStorage.setItem('restaurant-booking-api-base', 'http://你的地址')`。
  页面会尝试按顺序探测上述地址以及常见端口（8080/8880 的 localhost、127.0.0.1、[::1]），从而匹配你实际启动的后端。
- 若前端无法连接后端，请确认后端进程已启动且浏览器地址与 `API_BASE` 配置一致；内置的 CORS 头已允许从 `file://` 或不同主机发起请求。当探测失败时，界面会提示使用查询参数或控制台变量显式指定 API 地址。

前端仅作为课程作业的演示界面：连接 C++ 服务端时，数据存放在进程内存中，重启服务会恢复初始状态。

- **HTTP API 拓展**：
  - `GET /api/reservations/{id}`：返回单条预订的完整详情（顾客信息、时间、桌位、状态、最后更新时间等）。
  - `PUT /api/reservations/{id}`：使用 `application/x-www-form-urlencoded` 提交字段以更新顾客信息、就餐时间、时长、备注与（可选）桌位。
  - `DELETE /api/reservations/{id}`：直接删除该预订并清理所有关联订单与桌位占用。
  - `POST /api/reservations/{id}/table`：传入 `tableId` 可手动分配桌位，也可通过 `mode=auto` 触发系统自动匹配，或 `mode=clear` 释放当前桌位。
